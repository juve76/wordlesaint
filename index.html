<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Interactive Rosary</title>
    <style>
        /* --- General Layout and Typography --- */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f4f8;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            max-width: 900px;
            width: 100%;
            background: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        h1 {
            color: #4a148c; /* Deep Purple */
            margin-bottom: 5px;
            font-size: 2.2em;
            text-align: center;
        }
        
        /* --- Header and Info --- */
        .header-info {
            text-align: center;
            font-size: 1.1em;
            color: #6a6a6a;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
        }

        /* --- Mystery Section (Left/Top) --- */
        .mystery-container {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .mystery-text {
            flex: 1;
            padding: 15px;
            border-radius: 8px;
            background-color: #e3f2fd; /* Light Blue */
            text-align: left;
        }

        .mystery-title {
            color: #1e88e5; /* Medium Blue */
            font-size: 1.4em;
            font-weight: bold;
        }

        .mystery-description {
            font-style: italic;
            color: #333;
            margin-top: 10px;
        }

        /* --- Initial Beads (Visual Representation) --- */
        .initial-beads-path {
            flex: 1;
            padding: 15px;
            background-color: #f3e5f5; /* Light Purple */
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .crucifix {
            font-size: 2.5em;
            color: #4a148c;
            margin-bottom: 5px;
        }
        
        .initial-bead-group {
            display: flex;
            align-items: center;
        }
        
        .initial-bead-group .spacer {
            width: 15px;
            height: 2px;
            background: #4a148c;
        }

        /* --- Bead Styling (General) --- */
        .bead {
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            font-weight: bold;
            cursor: not-allowed;
            opacity: 0.5; 
            transition: background-color 0.3s, transform 0.2s, opacity 0.3s;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            position: relative; /* For the circular layout */
        }
        
        /* Size specific beads */
        .crucifix-bead, .large-bead {
            width: 40px;
            height: 40px;
            background-color: #7b1fa2; /* Purple */
        }

        .small-bead {
            width: 25px;
            height: 25px;
            background-color: #9c27b0; /* Lighter Purple */
        }

        /* Sequential control */
        .bead.current {
            cursor: pointer;
            opacity: 1; 
            box-shadow: 0 0 10px 5px #ffc107; /* Gold highlight */
            transform: scale(1.1);
            z-index: 10;
        }
        
        .bead.clicked {
            background-color: #2e7d32; /* Deep Green for completed */
            cursor: default;
            opacity: 1;
            box-shadow: none;
        }
        
        .bead.current:hover {
            transform: scale(1.2);
        }

        /* --- Circular Decade Layout (Main Rosary) --- */
        .rosary-circle {
            position: relative;
            width: 700px;
            height: 700px;
            margin: 50px auto;
        }

        /* Decade Wrapper (Hides the decade titles in the circle) */
        .decade-wrapper {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 1px dashed #ccc;
        }
        
        /* Positioning the Beads around the circle */
        /*
        We use a loop in JS to calculate precise positions, 
        but we need general styles for the placed beads.
        */
        .decade-wrapper .bead {
            position: absolute;
        }

        /* --- Tracking Section --- */
        .tracking-section {
            background-color: #343a40;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 30px;
            text-align: center;
        }

        .tracking-data {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .metric {
            padding: 10px;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #ffc107;
        }

        .reset-button {
            margin-top: 15px;
            padding: 10px 20px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .reset-button:hover { background-color: #c82333; }
        
    </style>
</head>
<body>
    <div class="container">
        <h1>Visual Interactive Holy Rosary</h1>
        <div class="header-info">
            Today is: <span id="current-day"></span>, <span id="current-date"></span>
            <br>
            <span id="mystery-label"></span>
        </div>

        <div class="mystery-container">
            <div class="mystery-text">
                <div class="mystery-title" id="current-mystery-name"></div>
                <div class="mystery-description" id="mystery-description-text"></div>
            </div>
            
            <div class="initial-beads-path">
                <span class="crucifix">‚Ä†</span>
                <div class="bead crucifix-bead" data-initial-bead="0">C</div> <div class="bead large-bead" data-initial-bead="1">O</div> <div class="initial-bead-group">
                    <div class="bead small-bead" data-initial-bead="2">H</div>
                    <div class="spacer"></div>
                    <div class="bead small-bead" data-initial-bead="3">H</div>
                    <div class="spacer"></div>
                    <div class="bead small-bead" data-initial-bead="4">H</div>
                </div>
                <div class="bead large-bead" data-initial-bead="5">G</div> </div>
        </div>

        <div class="rosary-circle">
            <div class="decade-wrapper" id="rosary-app">
                </div>
        </div>

        <div class="tracking-section">
            <h2>üèÜ Rosary Progress Tracker</h2>
            <div class="tracking-data">
                <div class="metric">
                    <div class="metric-value" id="total-rosaries">0</div>
                    <div>Total Rosaries Completed</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="current-streak">0</div>
                    <div>Consecutive Day Streak</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="last-completion">Never</div>
                    <div>Last Completion Date</div>
                </div>
            </div>
            <button class="reset-button" onclick="resetProgress()">Reset Tracking</button>
        </div>
    </div>

    <script>
        // --- JavaScript Logic for Rosary, Day Mapping, and Tracking ---

        // 1. Rosary Mystery Mapping (Standard Days) - Unchanged
        const mysteries = {
            'Sunday': {
                'Advent/Christmas': 'Glorious Mysteries',
                'Lent': 'Sorrowful Mysteries',
                'Easter/Ordinary': 'Glorious Mysteries'
            },
            'Monday': 'Joyful Mysteries',
            'Tuesday': 'Sorrowful Mysteries',
            'Wednesday': 'Glorious Mysteries',
            'Thursday': 'Luminous Mysteries',
            'Friday': 'Sorrowful Mysteries',
            'Saturday': 'Joyful Mysteries'
        };

        // 2. Decade Details with Descriptions (20 Total Mysteries) - Slightly simplified keys for brevity
        const decadesData = {
            'Joyful Mysteries': [
                { name: "The Annunciation", description: "The Angel Gabriel announces to Mary that she will conceive the Son of God, and Mary humbly consents." },
                { name: "The Visitation", description: "Mary visits her cousin Elizabeth, who is also pregnant, and John the Baptist leaps for joy in her womb." },
                { name: "The Nativity", description: "Jesus Christ, the Savior of the World, is born in poverty in a stable in Bethlehem." },
                { name: "The Presentation in the Temple", description: "Mary and Joseph present the baby Jesus in the Temple, where the aged Simeon and Anna prophesy about His mission." },
                { name: "The Finding in the Temple", description: "After three days of searching, Mary and Joseph find the 12-year-old Jesus teaching the elders in the Temple." }
            ],
            'Sorrowful Mysteries': [
                { name: "The Agony in the Garden", description: "Jesus prays in deep distress in the Garden of Gethsemane, accepting the cup of suffering from His Father's will." },
                { name: "The Scourging at the Pillar", description: "Pilate orders Jesus to be brutally scourged and bound to a pillar, inflicting immense pain upon His body." },
                { name: "The Crowning with Thorns", description: "Roman soldiers mock Jesus, dressing Him in a purple robe and pressing a painful crown of thorns onto His head." },
                { name: "The Carrying of the Cross", description: "Jesus carries the heavy wooden cross on His shoulders through the streets of Jerusalem toward Calvary." },
                { name: "The Crucifixion", description: "Jesus is nailed to the cross between two thieves, dies, and is lifted up for the salvation of the world." }
            ],
            'Glorious Mysteries': [
                { name: "The Resurrection", description: "On the third day, Jesus rises triumphantly from the dead, conquering sin and death and fulfilling the Scriptures." },
                { name: "The Ascension", description: "Forty days after His Resurrection, Jesus ascends into heaven to sit at the right hand of the Father." },
                { name: "The Descent of the Holy Spirit", description: "The Holy Spirit descends upon the Apostles and Mary in the Upper Room in the form of fire at Pentecost." },
                { name: "The Assumption of Mary", description: "At the end of her earthly life, the Blessed Virgin Mary is assumed body and soul into heaven." },
                { name: "The Coronation of Mary", description: "Mary is crowned as Queen of Heaven and Earth by her Son, Jesus, and the Father." }
            ],
            'Luminous Mysteries': [
                { name: "The Baptism in the Jordan", description: "Jesus is baptized by John the Baptist, and the Father declares, 'This is my beloved Son,' while the Holy Spirit descends." },
                { name: "The Wedding at Cana", description: "Jesus performs His first public miracle by turning water into wine at the request of His mother, Mary." },
                { name: "The Proclamation of the Kingdom", description: "Jesus calls all people to repentance, teaches the Gospel, and performs miracles as signs of the Kingdom of God." },
                { name: "The Transfiguration", description: "Jesus appears in His divine glory before Peter, James, and John on Mount Tabor, conversing with Moses and Elijah." },
                { name: "The Institution of the Eucharist", description: "At the Last Supper, Jesus institutes the Sacrament of the Eucharist, giving us His Body and Blood for the world's nourishment." }
            ]
        };

        // 3. Tracking Storage Keys (Unchanged)
        const STORAGE_KEYS = {
            TOTAL_ROSARIES: 'rosaryTotal',
            CURRENT_STREAK: 'rosaryStreak',
            LAST_COMPLETION: 'rosaryLastCompletion',
            TODAY_COMPLETED: 'rosaryTodayCompleted'
        };

        let currentMystery = '';
        const initialBeadsCount = 6; // 0 to 5
        const decadeBeadsCount = 5 * 11; // 55
        const requiredBeads = initialBeadsCount + decadeBeadsCount; // 61 total beads

        // State variables for sequential control
        let currentSection = 'initial'; // 'initial' or 'decades'
        let currentInitialBeadIndex = 0; // 0 to 5
        let currentDecadeIndex = 0;     // 0 to 4
        let currentBeadIndex = 0;       // 0 (Glory) to 10 (Hail Mary 10)

        // --- Utility Functions ---

        function getLiturgicalSeason() {
            const today = new Date();
            const month = today.getMonth();

            if (month >= 11 || month < 1) return 'Advent/Christmas';
            if (month >= 2 && month <= 3) return 'Lent'; 
            return 'Easter/Ordinary'; 
        }

        function getTodayMystery() {
            const today = new Date();
            const dayOfWeek = today.toLocaleDateString('en-US', { weekday: 'long' });
            let mysteryName = mysteries[dayOfWeek];

            if (dayOfWeek === 'Sunday') {
                const season = getLiturgicalSeason();
                mysteryName = mysteries['Sunday'][season];
            }
            return mysteryName;
        }

        /**
         * Finds the next bead element that should be clicked based on the current state.
         */
        function getNextBeadElement() {
            if (currentSection === 'initial') {
                return document.querySelector(`.bead[data-initial-bead="${currentInitialBeadIndex}"]`);
            } else {
                 return document.querySelector(
                    `.bead[data-decade="${currentDecadeIndex}"][data-bead="${currentBeadIndex}"]`
                );
            }
        }
        
        /**
         * Calculates the position of a bead in a circle.
         */
        function calculatePosition(index, totalBeads, radius) {
            // Start at the top (12 o'clock = -90 degrees) and go clockwise
            const angle = (index / totalBeads) * 360 - 90;
            const radians = angle * (Math.PI / 180);
            
            // Center is (radius, radius)
            const x = radius + radius * Math.cos(radians);
            const y = radius + radius * Math.sin(radians);

            return { x, y };
        }


        /**
         * Highlights the current sequential bead and updates the description text.
         */
        function highlightCurrentBead() {
            // 1. Remove highlight from all beads
            document.querySelectorAll('.bead').forEach(b => {
                if (!b.classList.contains('clicked')) {
                    b.classList.remove('current');
                    b.style.cursor = 'not-allowed';
                    b.style.opacity = '0.5';
                }
            });

            const nextBead = getNextBeadElement();
            if (nextBead) {
                nextBead.classList.add('current');
                nextBead.style.cursor = 'pointer';
                nextBead.style.opacity = '1';
            }

            // 2. Update Mystery Description
            const descriptionElement = document.getElementById('mystery-description-text');
            const mysteryTitleElement = document.getElementById('current-mystery-name');

            if (currentSection === 'initial') {
                mysteryTitleElement.textContent = "Initial Prayers";
                if (currentInitialBeadIndex === 0) {
                    descriptionElement.textContent = "Begin with the Sign of the Cross and the Apostles' Creed.";
                } else if (currentInitialBeadIndex === 1) {
                    descriptionElement.textContent = "Pray the Our Father for the intentions of the Pope and the Church.";
                } else if (currentInitialBeadIndex >= 2 && currentInitialBeadIndex <= 4) {
                    descriptionElement.textContent = "Pray three Hail Marys for the virtues of Faith, Hope, and Charity.";
                } else if (currentInitialBeadIndex === 5) {
                    descriptionElement.textContent = "Pray the Glory Be, then proceed to the first decade.";
                }
            } else if (currentSection === 'decades') {
                mysteryTitleElement.textContent = `${currentMystery}`;
                const mysteryIndex = currentDecadeIndex;
                if (decadesData[currentMystery] && decadesData[currentMystery][mysteryIndex]) {
                     descriptionElement.textContent = 
                        `${(mysteryIndex + 1)}. ${decadesData[currentMystery][mysteryIndex].name}: ${decadesData[currentMystery][mysteryIndex].description}`;
                }
            } else {
                 descriptionElement.textContent = "The Rosary is complete! Glory to God!";
                 mysteryTitleElement.textContent = "Completion";
            }
        }

        /**
         * Renders the decade beads in a circular pattern.
         */
        function renderRosaryCircle() {
            currentMystery = getTodayMystery();
            document.getElementById('current-mystery-name').textContent = currentMystery;
            const container = document.getElementById('rosary-app');
            container.innerHTML = '';
            
            const radius = 350; // Half the size of .rosary-circle (700px)
            const totalBeadsInCircle = 55;
            let totalIndex = 0;
            let html = '';

            // Generate 5 decades
            for (let d = 0; d < 5; d++) {
                // Generate 11 beads per decade (1 Glory/Our Father + 10 Hail Marys)
                for (let b = 0; b <= 10; b++) {
                    const beadType = (b === 0) ? 'large-bead' : 'small-bead';
                    const beadText = (b === 0) ? 'G/O' : 'H';
                    const { x, y } = calculatePosition(totalIndex, totalBeadsInCircle, radius);
                    
                    // Center the bead based on its size
                    const size = beadType === 'large-bead' ? 40 : 25;
                    const style = `left: ${x - (size / 2)}px; top: ${y - (size / 2)}px;`;

                    html += `<div class="bead ${beadType}" 
                                 style="${style}" 
                                 data-decade="${d}" 
                                 data-bead="${b}">
                                 ${beadText}
                            </div>`;
                    
                    totalIndex++;
                }
            }

            container.innerHTML = html;

            // Attach click handlers to circle beads
            document.querySelectorAll('.rosary-circle .bead').forEach(bead => {
                bead.addEventListener('click', sequentialToggleBead);
            });
            
            // Attach click handlers to initial beads
            document.querySelectorAll('.initial-beads-path .bead').forEach(bead => {
                bead.addEventListener('click', sequentialToggleBead);
            });

            highlightCurrentBead(); 
        }


        /**
         * Handles the bead click event for both initial and decade beads.
         */
        function sequentialToggleBead(event) {
            const bead = event.target;
            
            // Find bead indices
            const clickedInitial = bead.hasAttribute('data-initial-bead') ? parseInt(bead.getAttribute('data-initial-bead')) : -1;
            const clickedDecade = bead.hasAttribute('data-decade') ? parseInt(bead.getAttribute('data-decade')) : -1;
            const clickedBead = bead.hasAttribute('data-bead') ? parseInt(bead.getAttribute('data-bead')) : -1;

            // 1. Enforce Sequence
            let isCorrectClick = false;
            if (currentSection === 'initial' && clickedInitial === currentInitialBeadIndex) {
                isCorrectClick = true;
            } else if (currentSection === 'decades' && clickedDecade === currentDecadeIndex && clickedBead === currentBeadIndex) {
                isCorrectClick = true;
            }

            if (!isCorrectClick) {
                if (!bead.classList.contains('clicked')) {
                    alert("Please click the currently highlighted bead to proceed with the prayers!");
                }
                return;
            }

            // 2. Mark as completed
            bead.classList.remove('current');
            bead.classList.add('clicked');
            
            // 3. Advance the sequence trackers
            if (currentSection === 'initial') {
                if (currentInitialBeadIndex < initialBeadsCount - 1) {
                    currentInitialBeadIndex++;
                } else {
                    currentSection = 'decades'; // Move to the circular part
                    currentInitialBeadIndex = initialBeadsCount; // End marker
                    currentDecadeIndex = 0;
                    currentBeadIndex = 0;
                }
            } else if (currentSection === 'decades') {
                if (currentBeadIndex < 10) {
                    currentBeadIndex++; // Next Hail Mary
                } else if (currentDecadeIndex < 4) {
                    currentDecadeIndex++; // Next Decade
                    currentBeadIndex = 0;
                } else {
                    currentSection = 'complete'; // Rosary Finished
                }
            }
            
            // 4. Check for Rosary Completion (Gamification Trigger)
            if (currentSection === 'complete') {
                alert("üéâ Congratulations! You have completed the Rosary for today!");
                updateTracking();
            }
            
            // 5. Highlight the next bead and update description
            highlightCurrentBead();
        }

        // --- Tracking Functions (Same as previous versions) ---

        function loadTracking() {
            const total = parseInt(localStorage.getItem(STORAGE_KEYS.TOTAL_ROSARIES) || 0);
            const streak = parseInt(localStorage.getItem(STORAGE_KEYS.CURRENT_STREAK) || 0);
            const lastDateStr = localStorage.getItem(STORAGE_KEYS.LAST_COMPLETION) || 'Never';

            document.getElementById('total-rosaries').textContent = total;
            document.getElementById('current-streak').textContent = streak;
            document.getElementById('last-completion').textContent = lastDateStr === 'Never' ? 'Never' : new Date(lastDateStr).toLocaleDateString();
        }

        function updateTracking() {
            const today = new Date();
            const todayKey = today.toISOString().split('T')[0];
            const lastCompletionStr = localStorage.getItem(STORAGE_KEYS.LAST_COMPLETION);
            let total = parseInt(localStorage.getItem(STORAGE_KEYS.TOTAL_ROSARIES) || 0);
            let streak = parseInt(localStorage.getItem(STORAGE_KEYS.CURRENT_STREAK) || 0);

            if (localStorage.getItem(STORAGE_KEYS.TODAY_COMPLETED) === todayKey) {
                return;
            }

            total += 1;
            localStorage.setItem(STORAGE_KEYS.TOTAL_ROSARIES, total);

            if (lastCompletionStr) {
                const lastDate = new Date(lastCompletionStr);
                const diffTime = Math.abs(today.getTime() - lastDate.getTime());
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays === 1) {
                    streak += 1;
                } else if (diffDays > 1) {
                    streak = 1;
                }
            } else {
                streak = 1;
            }

            localStorage.setItem(STORAGE_KEYS.CURRENT_STREAK, streak);
            localStorage.setItem(STORAGE_KEYS.LAST_COMPLETION, today.toDateString());
            localStorage.setItem(STORAGE_KEYS.TODAY_COMPLETED, todayKey); 

            loadTracking(); 
        }

        function resetProgress() {
            if (confirm("Are you sure you want to reset all your Rosary tracking progress? This cannot be undone.")) {
                Object.values(STORAGE_KEYS).forEach(key => localStorage.removeItem(key));
                alert("Progress reset! The page will now reload.");
                window.location.reload();
            }
        }

        // --- Initialization ---

        function init() {
            const today = new Date();
            const dayOfWeek = today.toLocaleDateString('en-US', { weekday: 'long' });
            const dateStr = today.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });

            document.getElementById('current-day').textContent = dayOfWeek;
            document.getElementById('current-date').textContent = dateStr;
            document.getElementById('mystery-label').textContent = `Meditation on the: ${getTodayMystery()}`;
            document.getElementById('current-mystery-name').textContent = currentMystery; // Set initial title

            renderRosaryCircle();
            loadTracking();
        }

        init();
    </script>
</body>
</html>
